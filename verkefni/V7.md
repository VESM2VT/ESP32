# Tímaverkefni 7

- 30% af heildareinkunn
- Einstaklingsverkefni.
- Passaðu að þú getir útskýrt fyrir kennara allan kóða sem þú skilar, getir þú það ekki verður gefið 0 (núll) fyrir verkefnið.

---

## 1. Fjarstýring - ESPnow One-way samskipti (30%)

1. Tengdu íhlutina samkvæmt þessari [mynd](https://raw.githubusercontent.com/VESM2VT/ESP32/refs/heads/main/myndir/fjarstyring_h24.png).
1. Það þarf að vera hægt að keyra bílinn áfram og afturbak ásamt því að beygja til hægri og vinstri ásamt því að stjórna hraða og stoppa.
1. Það þarf að vera hægt er að keyra bílinn áfram og beygja til hliðar samtímis (semsagt **ekki** skriðdrekabeygjur).
1. Switch rofinn á fjarstýringunni kveikir/slekkur á lögguljósunum og sírenum.

<!-- 1. Forritaðu skottakkann á stýripinnnanum þannig að hann virkjar/afvirkjar hvort bíllinn er sjálfkeyrandi. -->

---

## 2. Fjarstýring -  ESPnow Two-way samskipti og OLED (30%)

1. Birtu fjarlægðamælingarnar frá Ultrasonic (bíll) með reglulegu millibili á OLED skjánum. 
1. Þegar bíllinn er minna en 50cm. frá hindrun (vegg) á að birtast textinn "Varlega!!!" á LCD skjánum og ef bíllinn er innan við 20cm. frá hindrun (vegg) þá á hann að stöðvast og birta "Stopp!!!" á OLED skjánum. Þegar bíllinn er innan við 20cm. frá hindrun getur hann ekki keyrt áfram, bara bakkað og beygt.
1. OLED skjárinn á líka að sýna á myndrænan hátt hraða bílsins og beygjur, frjáls útfærsla.

---

## 3. Fjarstýring - Samsetning (30%)

Settu íhlutina í fjarstýringuna. Settu skrúfur og segla þar sem við á. Lóðaðu saman víra til að dreifa 3,3V og GND.

---

## 4. Fjarstýring - Stýrt með snúðáttavita (10%)

Mpu6050 er snúðáttaviti (e. gyro compass (hér eftir kallað gyro)) og hröðunarskynjari. Lestu þér til um hann [hér](https://www.electronicwings.com/sensors-modules/mpu6050-gyroscope-accelerometer-temperature-sensor-module).

### Tengingar.
1. VCC - 3,3V
2. GND - GND
3. SCL - pin nr 4
4. SDA - pin nr 5

Annað á ekki að tengja við MPU6050

Sækið svo [þessa](https://github.com/Freenove/Freenove_Ultimate_Starter_Kit_for_ESP32_S3/blob/main/Python/Python_Libraries/mpu6050.py) skrá úr Freenove safninu og hlaðið upp í Thonny.

Dæmi um notkun á klasanum:
```python
from machine import Pin
from mpu6050 import MPU6050
from time import sleep_ms

mpu = MPU6050(4,5) # tengja IIC pin(sclpin,sdapin)
mpu.MPU_Init() # frumstilla MPU6050
sleep_ms(1000) # bið eftir MPU6050 virki stöðugt

gx, gy, gz = mpu.MPU_Get_Gyroscope() # sækir gildin á gíró
ax, ay, az = mpu.MPU_Get_Accelerometer() #sækir gildin á hröðuninni
```

### Að kvarða (e. calibrate).
Til að gyro hlutinn virki sem best þarf að kvarða (e. calibrate) hann. Það er gert þannig að MPU6050 er látinn liggja flatur á borði og síðan eru teknar margar (eitt þúsund að lágmarki) mælingar og meðaltal þeirra mælinga svo reiknað. Þær tölur sem koma út úr þessari aðgerð eru svo notaðar til að stilla af allar þær mælingar sem á eftir koma (draga kvörðunina frá mælingunni). Þetta þarf að gera fyrir x, y og z gildi mælinganna. Dæmi:

```python
mx, my, mz = 0, 0, 0
fjoldi_kvardana = 1000
for _ in range(fjoldi_kvardana):
    x, y, z = mpu.MPU_Get_Gyroscope()
    mx += x
    my += y
    mz += z
    sleep_us(5)

mx //= fjoldi_kvardana
my //= fjoldi_kvardana
mz //= fjoldi_kvardana

# og svo í lykkjunni
gx, gy, gz = mpu.MPU_Get_Gyroscope()
gx -= mx
gy -= my
gz -= mz
```

1. Forritaðu þannig að bæði gyro og hröðunargildin eru notuð með fjarstýringunni til að stýra bílnum. 
1. Forritaðu skottakkann á stýripinnnanum þannig að hann virkjar/afvirkjar MPU6050 stýringu (í staðinn fyrir stýripinna).

**Ath:** Það er gott að hafa smá sleep í while lykkjunni t.d. 50 ms.

---

## Námsmat og skil
- Yfirferð og námsmat á sér stað í tíma. 
- Fyrir hvern lið; gefið er heilt fyrir fullnægjandi lausn, hálft ef lausn er ábótavant, ekkert ef lausn er stórlega ábótavant eða vantar. 
- Skilaðu á Innu öllum kóðalausnum.
